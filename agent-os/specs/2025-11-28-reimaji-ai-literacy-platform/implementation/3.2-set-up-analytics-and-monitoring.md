# 3.2 Set up Analytics and Monitoring

## Goal

Implement comprehensive analytics to track user behavior, conversions, and key performance indicators (KPIs) to support the business goal of 50 paid users.

## Proposed Changes

### 1. User Behavior Analytics (Task 3.2.1)

- **Backend**: Add `trackUserAction` mutation to `convex/analytics.ts`.
- **Frontend**: Create a `useTrackAction` hook for easy implementation.
- **Implementation**: Track key actions:
  - `news_view` / `research_view` (already partially covered by page views, but explicit action is good)
  - `lesson_start` / `lesson_complete`
  - `quiz_start` / `quiz_complete`
  - `search_performed`

### 2. Conversion Tracking (Task 3.2.2)

- **Backend**: Add `trackConversion` mutation to `convex/analytics.ts`.
- **Implementation**: Track conversion events:
  - `signup` (in `src/app/(auth)/sign-up/[[...index]]/page.tsx` or via webhook sync) -> _Actually, best to track on first login/dashboard access if webhook isn't fully reliable yet, or just use `users` table creation time._
  - `course_start` (First lesson view)
  - `course_complete` (All lessons done)
  - `subscription_start` (Mock for now)

### 3. KPI Dashboard (Task 3.2.3)

- **Backend**: Create `getKPIs` query in `convex/analytics.ts` to aggregate data:
  - Total Users
  - Active Users (last 30 days)
  - Conversion Rate (Visitor -> User)
  - Course Completion Rate
- **Frontend**: Create `/admin/kpi` page using `recharts` (if available) or simple stats cards.
  - _Note: `recharts` might not be installed. I'll check package.json. If not, I'll use simple UI cards._

## Verification Plan

- **Automated**:
  - `npm run type-check`
  - `npm run lint`
  - `npm run build`
- **Manual**:
  - Trigger actions (view news, start lesson) and verify data in `user_actions` table via Dashboard or `npx convex dashboard`.
  - Verify `conversions` table population.
  - Check `/admin/kpi` loads with correct aggregated data.
