# 3.1 Optimize Application Performance

## Goal

Improve application performance to achieve load times under 2 seconds and ensure scalability.

## Proposed Changes

### 1. Database Query Optimization (Convex)

- **News**: Update `list` query in `convex/news.ts` to use `.withIndex('by_isPublished')`.
- **Research**: Update `list` query in `convex/research.ts` to use `.withIndex('by_isPublished')`.
- **Courses**: Update `list` query in `convex/courses.ts` to use `.withIndex('by_isPublished')`.
- **General**: Ensure all public-facing list queries use appropriate indexes instead of full table scans.

### 2. Caching Strategies (Next.js)

- Implement `preloadQuery` pattern for Server Components in:
  - `src/app/(public)/news/page.tsx`
  - `src/app/(public)/research/page.tsx`
  - `src/app/(app)/lms/courses/page.tsx`
- This ensures data is fetched on the server and hydrated on the client, reducing round trips.

### 3. Performance Monitoring

- Create a `PerformanceMonitor` component (client-side) that uses `useReportWebVitals`.
- Send metrics (LCP, FID, CLS) to the `page_views` table in Convex.
- Add this component to the root layout.

## Verification Plan

- **Automated**:
  - Run `npm run type-check`
  - Run `npm run lint`
  - Run `npm run build`
- **Manual**:
  - Verify News, Research, and Course lists load correctly.
  - Check Convex dashboard (if accessible) or logs to ensure queries are using indexes.
  - Check `page_views` table to see if performance metrics are being recorded.
