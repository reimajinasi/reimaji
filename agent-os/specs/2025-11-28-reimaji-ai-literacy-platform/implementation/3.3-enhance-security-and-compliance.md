# 3.3 Enhance Security and Compliance

## Goal

Ensure the platform is secure, compliant with basic data privacy standards, and has disaster recovery procedures in place.

## Proposed Changes

### 1. Security Audit (Task 3.3.1)

- **Action**: Conduct a self-audit of the codebase.
- **Deliverable**: Create `docs/security-audit.md` containing:
  - RBAC verification (ensure all mutations/queries have `ensureRole` or public access justification).
  - Input validation checks (Zod/Convex validators).
  - Security headers configuration in `next.config.ts`.
  - Dependency vulnerability check (`npm audit`).

### 2. Data Privacy Controls (Task 3.3.2)

- **Feature**: User Account Deletion (Right to Erasure).
- **Backend**: Add `deleteAccount` mutation in `convex/users.ts`.
  - Should soft-delete the user (`deletedAt`) and potentially anonymize PII (`email`, `name`) if required, but for now soft-delete is the MVP approach.
  - Should cascade soft-delete to related data or keep it orphaned but anonymized.
- **Frontend**: Add "Danger Zone" in `src/app/(app)/profile/page.tsx` with a "Delete Account" button and confirmation dialog.

### 3. Backup and Recovery (Task 3.3.3)

- **Action**: Document procedures.
- **Deliverable**: Create `docs/backup-recovery.md`.
  - Explain Convex's built-in backup/restore capabilities.
  - Provide a script or instruction for manual data export (JSON dump) for off-site backup compliance.

## Verification Plan

- **Automated**:
  - `npm run type-check`
  - `npm run lint`
  - `npm run build`
- **Manual**:
  - Test "Delete Account" flow: User deletes account -> Redirect to home -> Try login (should fail or show deleted state).
  - Verify `docs/security-audit.md` and `docs/backup-recovery.md` exist.
